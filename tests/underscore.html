<!DOCTYPE HTML>
<html>
<head>
    
    <meta charset="UTF-8" />
    <title>QUnit - backstab/underscore.js</title>
	<link href="http://code.jquery.com/qunit/qunit-1.12.0.css" rel="stylesheet" type="text/css" />

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js" type="text/javascript"></script>
	<script src="http://documentcloud.github.com/underscore/underscore-min.js" type="text/javascript"></script>
	<script src="http://documentcloud.github.com/backbone/backbone-min.js" type="text/javascript"></script>
	
	<script src="../backstab/underscore.js" type="text/javascript"></script>
	
</head>

<body>

<div id="qunit"></div>
<div id="qunit-fixture"></div>
<script src="http://code.jquery.com/qunit/qunit-1.12.0.js" type="text/javascript"></script>

<script type="text/javascript">

var expected = function( actualRes, params, msg ) {
	
	var suffix = '';
	var expectedRes = params._exp;
	var actualResStr = _.stringify( actualRes );
	var expectedResStr = _.stringify( expectedRes );
	
	params._act = actualRes;
	
	if ( actualRes === expectedRes ) {
		suffix = ' (result: ' + actualResStr + ')';	
	}
	
	$.each( params, function( k, v ) {
		msg = msg.replace( '{{' + k + '}}', _.stringify( v ) );
	} );
	
	equal( actualRes, expectedRes, msg + suffix );
};

test( "_.beginsWith()", function() {
	
	var vals1 = {
		_exp: true,
		haystack: 'The quick brown fox...',
		needle: 'The'
	};
	expected(
		_.beginsWith( vals1.haystack, vals1.needle ), vals1,
		'{{haystack}} begins with "{{needle}}"'
	);
	
	var vals2 = {
		_exp: false,
		haystack: 'quick brown fox...',
		needle: 'The'
	};	
	expected(
		_.beginsWith( vals2.haystack, vals2.needle ), vals2,
		'{{haystack}} does not begin with "{{needle}}"'
	);
	
	var vals3 = {
		_exp: 'brown',
		haystack: 'brown fox quick...',
		needle: [ 'quick', 'brown', 'fox' ]
	};
	expected(
		_.beginsWith( vals3.haystack, vals3.needle ), vals3,
		'{{haystack}} begins with "quick", "brown", or "fox"'
	);
	
	var vals4 = {
		_exp: false,
		haystack: 'black fox quick...',
		needle: [ 'quick', 'brown', 'fox' ]
	};
	expected(
		_.beginsWith( vals4.haystack, vals4.needle ), vals4,
		'{{haystack}} does not begin with "quick", "brown", or "fox"'
	);
	
} );

test( "_.expandCurlyShortform()", function() {

	var vals1 = { _exp: 'click a' };
	expected(
		_.expandCurlyShortform( vals1._exp ), vals1,
		'Value {{_act}} should not change.'
	);
	
	var vals2 = { _exp: 'click #a, #b, #c' };
	expected(
		_.expandCurlyShortform( vals2._exp ), vals2,
		'Value {{_act}} should not change.'
	);

	var vals3 = {
		_exp: 'foo:bar; foo:baz',
		arg: 'foo:{ bar; baz }'
	};
	expected(
		_.expandCurlyShortform( vals3.arg ), vals3,
		'Value {{arg}} should change to {{_exp}}.'
	);
	
	var vals4 = {
		_exp: 'foo:bar; foo:baz; foo:',
		arg: 'foo:{ bar; baz; }'
	};
	expected(
		_.expandCurlyShortform( vals4.arg ), vals4,
		'Value {{arg}} should change to {{_exp}}.'
	);
	
	var vals5 = {
		_exp: 'foo:bar div > a; foo:baz div > a; fruit:type:apple div .one, .two; fruit:type:pear p .one, .two; fruit:type:grape .one, .two',
		arg: 'foo:{ bar; baz } div > a; fruit:type:{ apple div; pear p; grape } .one, .two'
	};
	expected(
		_.expandCurlyShortform( vals5.arg ), vals5,
		'Value {{arg}} should change to {{_exp}}.'
	);
	
} );

</script>

</body>

</html>
